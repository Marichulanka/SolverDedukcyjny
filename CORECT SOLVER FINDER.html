<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Solver Dedukcyjny - BASIC</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    background: #1e1e1e;
    color: #eee;
    margin: 0;
    padding: 20px;
  }

  h2 {
    text-align: center;
    color: #ffcc00;
  }

  .board {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 20px;
    justify-content: center;
  }

  .ring {
    background: #2a2a2a;
    padding: 15px;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 150px;
    box-shadow: 0 0 10px rgba(255,255,255,0.1);
  }

  .ring label {
    font-weight: bold;
  }

  select, input {
    padding: 8px;
    border-radius: 6px;
    border: none;
    font-size: 1rem;
    width: 100%;
    box-sizing: border-box;
  }

  select {
    cursor: pointer;
    background: #333;
    color: #eee;
    border: 1px solid #555;
    transition: background-color 0.3s, color 0.3s;
  }

  select:focus {
    outline: 2px solid #ffcc00;
    border-color: #ffcc00;
  }

  select:hover {
    background: #444;
  }

  input[type="number"] {
    background: #444;
    color: #fff;
    border: 1px solid #555;
  }

  input[type="number"]:focus {
    outline: 2px solid #ffcc00;
    border-color: #ffcc00;
  }

  button {
    padding: 12px 20px;
    margin: 10px 5px 0 0;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    transition: 0.2s;
  }

  button:hover {
    opacity: 0.9;
  }

  .btn-add { background: #28a745; color: #fff; }
  .btn-reset { background: #dc3545; color: #fff; }

  .result {
    margin-top: 20px;
    background: #222;
    padding: 15px;
    border-radius: 10px;
    max-height: 800px;
    overflow-y: auto;
    font-family: 'Arial', sans-serif;
    line-height: 1.6;
  }

  .result h3 {
    color: #ffcc00;
    margin-bottom: 10px;
  }

  .result p {
    margin: 5px 0;
  }
</style>
</head>
<body>

<h2>Solver dedukcyjny (BASIC TARCZE) ‚Äì Start od 0</h2>
<p style="text-align:center;">Kolejno≈õƒá: <b>zewnƒôtrzny ‚Üí ≈õrodek</b></p>

<div class="board" id="board-container">
  <div class="ring">
    <label>1</label>
    <select class="color"><option>blue</option><option>green</option><option>red</option><option>orange</option></select>
    <input type="number" class="val" placeholder="Warto≈õƒá">
  </div>
  <div class="ring">
    <label>2</label>
    <select class="color"><option>blue</option><option>green</option><option>red</option><option>orange</option></select>
    <input type="number" class="val" placeholder="Warto≈õƒá">
  </div>
  <div class="ring">
    <label>3</label>
    <select class="color"><option>blue</option><option>green</option><option>red</option><option>orange</option></select>
    <input type="number" class="val" placeholder="Warto≈õƒá">
  </div>
  <div class="ring">
    <label>4</label>
    <select class="color"><option>blue</option><option>green</option><option>red</option><option>orange</option></select>
    <input type="number" class="val" placeholder="Warto≈õƒá">
  </div>
</div>

<div style="text-align:center;">
  <button class="btn-add" onclick="addBoard()">‚ûï Dodaj tarczƒô</button>
  <button class="btn-reset" onclick="resetAll()">üóë Reset</button>
  <button id="bullseyeBtn" class="btn-add" onclick="toggleBullseye()">Bullseye: OFF</button>
</div>

<div id="out" class="result"></div>

<script>
const colors = ["blue", "green", "red", "orange"];
const ops = ["+", "-", "*", "/"];
let globalSet = null;
let uiBoards = [];
let bullseye = false;

// Inicjalizacja koloru select
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.color').forEach(sel => {
    sel.addEventListener('change', function() {
      const color = this.value;
      this.style.backgroundColor = color;
      this.style.color = (color === 'orange' || color === 'yellow') ? '#000' : '#fff';
    });
    // Ustaw poczƒÖtkowy kolor
    const initialColor = sel.value;
    sel.style.backgroundColor = initialColor;
    sel.style.color = (initialColor === 'orange' || initialColor === 'yellow') ? '#000' : '#fff';
  });

  // PoczƒÖtkowy tekst w out
  document.getElementById("out").innerHTML = "<p>Wpisz lub wybierz plik z tarczami aby rozpoczƒÖƒá</p>";
});

function toggleBullseye() {
  bullseye = !bullseye;
  document.getElementById('bullseyeBtn').textContent = `Bullseye: ${bullseye ? 'ON' : 'OFF'}`;
}

function apply(a, op, b) {
  if (op === "+") return a + b;
  if (op === "-") return a - b;
  if (op === "*") return a * b;
  if (op === "/") return b !== 0 ? a / b : null;
}

function permutations(arr) {
  if (arr.length === 1) return [arr];
  let res = [];
  for (let i = 0; i < arr.length; i++) {
    let rest = permutations(arr.slice(0, i).concat(arr.slice(i + 1)));
    for (let r of rest) res.push([arr[i], ...r]);
  }
  return res;
}

function addBoard() {
  const rings = [...document.querySelectorAll(".ring")].map(ring => {
    const color = ring.querySelector(".color").value;
    const val = Number(ring.querySelector(".val").value);
    return {color, val};
  });
  processBoard(rings);
  uiBoards.push(rings);
  render();
}

function processBoard(rings) {
  const ringColors = rings.map(r => r.color);
  const vals = rings.map(r => r.val);
  const valid = new Set();
  const opPerms = permutations(ops);

  for (let perm of opPerms) {
    let map = {};
    colors.forEach((c, i) => map[c] = perm[i]);

    for (let dir of ["OUT‚ÜíIN", "IN‚ÜíOUT"]) {
      let order = dir === "OUT‚ÜíIN" ? [...vals.keys()] : [...vals.keys()].reverse();
      let value = 0;
      let ok = true;

      for (let i = 0; i < order.length; i++) {
        let idx = order[i];
        let op = map[ringColors[idx]];
        value = apply(value, op, vals[idx]);
        if (value === null || !Number.isInteger(value)) {
          ok = false;
          break;
        }
      }

      if (ok) valid.add(JSON.stringify({ map, dir }));
    }
  }

  if (globalSet === null) {
    globalSet = valid;
  } else {
    globalSet = new Set([...globalSet].filter(x => valid.has(x)));
  }
}

function render() {
  const out = document.getElementById("out");
  out.innerHTML = "";

  if (!globalSet || globalSet.size === 0) {
    out.innerHTML = "<p>‚ùå Brak sp√≥jnej teorii ‚Äì kt√≥ra≈õ tarcza ≈Çamie regu≈Çy</p>";
    return;
  }

  let i = 1;
  for (let entry of globalSet) {
    const { map, dir } = JSON.parse(entry);
    out.innerHTML += `<h3>‚úî RozwiƒÖzanie ${i++}</h3>`;
    out.innerHTML += `<p><strong>Kierunek:</strong> ${dir}</p>`;
    out.innerHTML += `<p><strong>Mapowanie:</strong> blue=${map.blue}, green=${map.green}, red=${map.red}, orange=${map.orange}</p>`;
    out.innerHTML += `<p><strong>Wynik dla ostatniej tarczy:</strong> `;

    if (uiBoards.length > 0) {
      const board = uiBoards[uiBoards.length - 1];
      const ringColors = board.map(r => r.color);
      const vals = board.map(r => r.val);
      let order = dir === "OUT‚ÜíIN" ? [...vals.keys()] : [...vals.keys()].reverse();
      let value = 0;
      for (let j = 0; j < order.length; j++) {
        let idx = order[j];
        let op = map[ringColors[idx]];
        value = apply(value, op, vals[idx]);
      }
      if (bullseye) value = Math.pow(value, 2);
      out.innerHTML += `${value}</p>`;
    } else {
      out.innerHTML += `Brak tarcz z UI</p>`;
    }
  }
}

function resetAll() {
  globalSet = null;
  uiBoards = [];
  document.getElementById("out").innerHTML = "<p>Zresetowano dane.</p>";
}
</script>

</body>
</html>
